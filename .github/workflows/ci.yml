name: CI Pipeline

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

env:
  PYTHON_VERSION: "3.11"

jobs:
  # Minimal smoke test - just verify the code can run
  smoke-test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: ${{ env.PYTHON_VERSION }}
      
      - name: Install basic dependencies
        run: |
          pip install --upgrade pip
          pip install pydantic pydantic-settings fastapi
      
      - name: Basic Python syntax check
        run: python -m py_compile $(find . -name "*.py" | head -10)
      
      - name: Test critical service imports
        run: |
          python -c "
          import sys
          sys.path.insert(0, '.')
          
          try:
              print('Testing pydantic_settings...')
              from pydantic_settings import BaseSettings
              print('‚úÖ pydantic_settings works')
              
              print('Testing basic service configs...')
              import services.orchestrator.core.config
              print('‚úÖ Orchestrator config works')
              
              import services.evaluation.core.config
              print('‚úÖ Evaluation config works')
              
              # Model service requires torch - test separately
              try:
                  import services.model_service.core.config
                  print('‚úÖ Model service config works')
              except ImportError as e:
                  print(f'‚ö†Ô∏è Model service config skipped (missing torch): {e}')
              
              print('üéâ Critical services ready - pipeline ready for AWS deployment!')
          except Exception as e:
              print(f'‚ùå Critical import failed: {e}')
              sys.exit(1)
          "