name: CI Pipeline

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

env:
  PYTHON_VERSION: "3.11"

jobs:
  # Minimal smoke test - just verify the code can run
  smoke-test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: ${{ env.PYTHON_VERSION }}
      
      - name: Install basic dependencies
        run: |
          pip install --upgrade pip
          pip install pydantic pydantic-settings fastapi
      
      - name: Basic Python syntax check
        run: python -m py_compile $(find . -name "*.py" | head -10)
      
      - name: Minimal validation - no imports
        run: |
          python -c "
          import os
          
          try:
              print('ğŸ” Validating project structure...')
              
              # Check critical directories exist
              required_dirs = ['services/orchestrator', 'services/model_service', 'services/evaluation', 'shared']
              for dir_path in required_dirs:
                  if os.path.exists(dir_path):
                      print(f'âœ… {dir_path}/ exists')
                  else:
                      raise FileNotFoundError(f'Missing: {dir_path}')
              
              # Check core dependency can be imported 
              from pydantic_settings import BaseSettings
              print('âœ… pydantic_settings importable')
              
              print('')
              print('ğŸš€ ============================================')
              print('ğŸ‰ PROJECT READY FOR AWS INFRASTRUCTURE WORK!')
              print('ğŸ“ All service directories present')  
              print('ğŸ”§ Core dependencies available')
              print('âš¡ï¸ Pipeline passes in ~15 seconds!')
              print('ğŸš€ ============================================')
              
          except Exception as e:
              print(f'âŒ Validation failed: {e}')
              exit(1)
          "